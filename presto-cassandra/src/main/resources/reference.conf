# DataStax Java Driver 4.x Configuration for Presto Cassandra Connector
# This file contains default settings for the Cassandra driver
# See: https://github.com/apache/cassandra-java-driver/blob/4.x/core/src/main/resources/reference.conf

datastax-java-driver {
  
  basic {
    # Contact points are set programmatically via CqlSession.builder()
    # Do not set them here
    
    # Session keyspace (optional, can be set programmatically)
    # session-keyspace = ""
    
    request {
      # Request timeout (overridden programmatically from Presto config)
      timeout = 12 seconds
      
      # Default consistency level
      consistency = LOCAL_ONE
      
      # Page size for SELECT queries
      page-size = 5000
      
      # Serial consistency for lightweight transactions
      serial-consistency = SERIAL
    }
    
    load-balancing-policy {
      # Local datacenter (set programmatically from Presto config)
      # local-datacenter = ""
      
      # Use default load balancing policy (replaces multiple 3.x policies)
      class = DefaultLoadBalancingPolicy
      
      # Slow replica avoidance
      slow-replica-avoidance = true
    }
    
    # Cloud configuration (for DataStax Astra)
    # Configured programmatically when cassandra.cloud.secure-connect-bundle is set
    # cloud {
    #   secure-connect-bundle = /path/to/secure-connect-bundle.zip
    # }
  }
  
  advanced {
    
    # Reconnection policy
    reconnection-policy {
      class = ExponentialReconnectionPolicy
      base-delay = 500 milliseconds
      max-delay = 10 seconds
    }
    
    # Retry policy (can be overridden with custom implementation)
    retry-policy {
      class = DefaultRetryPolicy
    }
    
    # Speculative execution (disabled by default, configured via Presto config)
    speculative-execution-policy {
      class = NoSpeculativeExecutionPolicy
    }
    
    # Socket options
    socket {
      # Read timeout (overridden from Presto config)
      read-timeout = 12 seconds
      
      # Connect timeout (overridden from Presto config)
      connect-timeout = 5 seconds
      
      # TCP no-delay
      tcp-no-delay = true
      
      # Keep-alive
      keep-alive = false
    }
    
    # Connection pool
    connection {
      max-requests-per-connection = 1024
      pool {
        local.size = 1
        remote.size = 1
      }
    }
    
    # Protocol options
    protocol {
      # Protocol version (auto-negotiated by default)
      # Driver 4.x automatically negotiates the best protocol version
      # Supports V3, V4, V5 depending on Cassandra version
      
      # Compression
      compression = lz4
    }
    
    # Authentication (set programmatically from Presto config)
    # auth-provider {
    #   class = PlainTextAuthProvider
    #   username = ""
    #   password = ""
    # }
    
    # SSL/TLS (configured programmatically when cassandra.tls.enabled=true)
    # ssl-engine-factory {
    #   class = DefaultSslEngineFactory
    #   truststore-path = /path/to/truststore.jks
    #   truststore-password = password
    #   keystore-path = /path/to/keystore.jks
    #   keystore-password = password
    # }
    
    # Metadata
    metadata {
      # Schema refresh
      schema {
        enabled = true
        # Empty list means all keyspaces (can be filtered via Presto config)
        refreshed-keyspaces = []
        request-timeout = 10 seconds
        request-page-size = 5000
      }
      
      # Token map (required for token-aware routing)
      token-map {
        enabled = true
      }
    }
    
    # Metrics (disabled by default to avoid overhead)
    # Can be enabled via Presto configuration if needed
    metrics {
      session {
        enabled = []
        # Available metrics:
        # - bytes-sent
        # - bytes-received
        # - connected-nodes
        # - cql-requests
        # - cql-client-timeouts
        # - cql-prepared-cache-size
        # - throttling.delay
        # - throttling.queue-size
        # - throttling.errors
      }
      node {
        enabled = []
        # Available metrics:
        # - bytes-sent
        # - bytes-received
        # - cql-messages
        # - errors.request.unsent
        # - errors.request.aborted
        # - errors.request.write-timeouts
        # - errors.request.read-timeouts
        # - errors.request.unavailables
        # - errors.request.others
        # - errors.connection.init
        # - errors.connection.auth
        # - retries.total
        # - retries.aborted
        # - retries.read-timeout
        # - retries.write-timeout
        # - retries.unavailable
        # - retries.other
        # - ignores.total
        # - ignores.aborted
        # - ignores.read-timeout
        # - ignores.write-timeout
        # - ignores.unavailable
        # - ignores.other
        # - speculative-executions
        # - pool.open-connections
        # - pool.available-streams
        # - pool.in-flight
        # - pool.orphaned-streams
      }
    }
    
    # Request throttling (optional, can be enabled if needed)
    # Useful for rate limiting in high-throughput scenarios
    # throttler {
    #   class = ConcurrencyLimitingRequestThrottler
    #   max-concurrent-requests = 10000
    #   max-queue-size = 100000
    # }
    
    # Timestamp generator (default is AtomicTimestampGenerator)
    # timestamp-generator {
    #   class = AtomicTimestampGenerator
    #   drift-warning {
    #     threshold = 1 second
    #     interval = 10 seconds
    #   }
    # }
    
    # Request logger (disabled by default)
    # request-logger {
    #   class = RequestLogger
    #   success.enabled = false
    #   slow.enabled = true
    #   slow.threshold = 1 second
    #   error.enabled = true
    #   max-query-length = 500
    #   show-values = true
    #   max-value-length = 50
    #   max-values = 50
    #   show-stack-traces = true
    # }
  }
}

# Made with Bob
